<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>Investors — MG Capital CRM</title>
  <style>
    :root{--bg:#0a0b10;--card:#121320;--muted:#8b90a5;--text:#eef1ff;--accent:#6e7bff;--accent-2:#45d1c4;--radius:18px}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Inter,system-ui;background:#0a0b10;color:var(--text)}
    .container{padding:16px;max-width:1200px;margin:auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px;flex-wrap:nowrap}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:800;color:#fff}
    h1{font-size:clamp(20px,3vw,26px);margin:0}
    .toolbar{display:flex;gap:8px;align-items:center;white-space:nowrap;overflow-x:auto;padding-bottom:2px;-webkit-overflow-scrolling:touch} .toolbar::-webkit-scrollbar{display:none} 
    .btn{padding:8px 12px;border-radius:10px;border:1px solid #ffffff20;background:#ffffff10;color:var(--text);cursor:pointer;text-decoration:none}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#4b56f7);border-color:transparent}

    /* Header nav links (match Projects style, no underline) */
    .nav-link{display:inline-block;padding:8px 12px;border-radius:999px;border:1px solid #ffffff24;background:#ffffff0f;color:var(--text);text-decoration:none}
    .nav-link.active{background:linear-gradient(135deg,var(--accent),#4b56f7);border-color:transparent}
    .nav-link:hover{background:#ffffff1a}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#4b56f7);border-color:transparent}

    .metrics{display:grid;gap:12px;grid-template-columns:repeat(2,1fr);margin-bottom:16px}
    .card{background:#121320;border:1px solid #ffffff14;border-radius:12px;padding:12px;box-shadow:0 6px 20px #0006}
    .metric h3{margin:0;font-size:13px;color:#cfd6ff}
    .metric .value{font-size:20px;font-weight:700;margin-top:4px;display:flex;align-items:center;justify-content:space-between} .metric .icon{font-size:18px;margin-left:6px}

    #tableView{overflow-x:auto}
    table{width:100%;border-collapse:separate;border-spacing:0 6px;font-size:14px}
    thead th{font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:#b4b8d6;text-align:left;padding:0 10px}
    tbody tr{background:#0e1020;border:1px solid #ffffff14}
    tbody td{padding:10px}
    tbody tr td:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}

    .board{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .column{min-height:280px;background:#0e1020;border:1px solid #ffffff14;border-radius:18px;padding:12px}
    .col-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;font-size:14px}
    .card-mini{background:#11142a;border:1px solid #ffffff12;border-radius:14px;padding:10px;margin-bottom:10px;font-size:13px}

    @media(max-width:640px){.metrics{grid-template-columns:1fr 1fr}.board{grid-template-columns:1fr}}
  .brand{display:flex;align-items:center;gap:12px}
.progress{height:6px;border-radius:999px;background:#ffffff1a;overflow:hidden;margin-top:6px}
.progress .fill{height:100%;width:0;transition:width .3s ease}
.progress .fill.comm{background:linear-gradient(90deg,#45d1c4,#3ab0a8)}
.progress .fill.weight{background:linear-gradient(90deg,#6e7bff,#4b56f7)}
.metric .value-row{display:flex;justify-content:space-between;align-items:center}
.kpi-icon svg{width:20px;height:20px;opacity:.9}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand"><div class="logo">MG</div><h1>Investor & Project Pipeline</h1></div>
      <div class="toolbar">
        <a href="projects.html" class="nav-link">Projects</a>
        <a href="investors.html" class="nav-link active">Investors</a>
        <a href="calendar.html" class="nav-link">Calendar</a>
      </div>
    </header>

    <section class="metrics">
      <!-- 1) Total Investors -->
      <div class="card metric">
        <h3>Total Investors</h3>
        <div class="value-row">
          <div class="value" id="iCount">0</div>
          <div class="kpi-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- 2) Total Committed -->
      <div class="card metric">
        <h3>Total Committed</h3>
        <div class="value-row">
          <div class="value" id="iCommittedTotal">$0</div>
          <div class="kpi-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 1v22"></path>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7H14a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </div>
        </div>
        <div class="progress" aria-label="Committed vs Available"><div class="fill comm" id="fillCommitted"></div></div>
      </div>

      <!-- 3) Weighted Pipeline -->
      <div class="card metric">
        <h3>Weighted Pipeline</h3>
        <div class="value-row">
          <div class="value" id="iWeighted">$0</div>
          <div class="kpi-icon" aria-hidden="true">
            <!-- Simplified chart-style icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 3v18h18"/>
              <line x1="9" y1="17" x2="9" y2="10"/>
              <line x1="15" y1="17" x2="15" y2="7"/>
              <line x1="21" y1="17" x2="21" y2="4"/>
            </svg>
          </div>
        </div>
        <div class="progress" aria-label="Weighted vs Available"><div class="fill weight" id="fillWeighted"></div></div>
      </div>

      <!-- 4) Total Available -->
      <div class="card metric">
        <h3>Total Available</h3>
        <div class="value-row">
          <div class="value" id="iAvailable">$0</div>
          <div class="kpi-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="4" width="20" height="16" rx="2"/>
              <path d="M7 9h10M7 13h6"/>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="toolbar" style="gap:10px;align-items:center">
        <strong>Investors</strong>
        <input id="q" placeholder="Search investors…" style="min-width:220px" />
        <div style="margin-left:auto"></div>
        <button class="btn primary" id="addBtn">+ Add Investor</button>
      </div>
      <div id="tableView" style="margin-top:10px">
        <table>
          <thead><tr><th>Name</th><th>Interest</th><th>Available</th><th>Status</th><th>Next Step</th><th>Due</th><th></th></tr></thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <div id="boardView" class="board hidden" style="margin-top:10px"></div>
    </section>
  </div>

  <dialog id="modal"><form method="dialog">
    <div class="modal-head"><strong id="modalTitle">Add Investor</strong><button class="btn" value="close">✕</button></div>
    <div class="modal-body">
      <div class="two">
        <label>Name<br/><input id="f_name" required /></label>
        <label>Status<br/><select id="f_status"><option>Lead</option><option>Contacted</option><option>NDA</option><option>Deligence</option><option>Committed</option><option>Declined</option></select></label>
      </div>
      <div class="two">
        <label>Next Step<br/><input id="f_next" /></label>
        <label>Due Date<br/><input id="f_due" type="date" /></label>
      </div>
      <div class="two">
        <label>Interest ($)<br/><input id="f_interest" /></label>
        <label>Available Cap ($)<br/><input id="f_available" /></label>
      </div>
      <input id="f_id" type="hidden" />
    </div>
    <div class="modal-actions"><button class="btn" value="close">Cancel</button><button class="btn primary" id="saveBtn">Save</button></div>
  </form></dialog>

  <script>
    const FIT_MAP = { 'Lead':5, 'Contacted':10, 'NDA':30, 'Deligence':60, 'Diligence':60, 'Committed':100, 'Declined':0 };
    function fitFromStatus(s){ return FIT_MAP[s] ?? 0; }

    function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}
    function load(){try{return JSON.parse(localStorage.getItem('mgcrm_investors')||'[]')}catch{return[]}}
    function save(){localStorage.setItem('mgcrm_investors',JSON.stringify(db));render()}
    let db=load();

    try { if(Array.isArray(db)){ db=db.map(x=>({...x, fit:fitFromStatus(x.status)})); } } catch{}

    function render(){
      const q=(document.getElementById('q').value||'').toLowerCase();
      const items=db.filter(x=>!q||x.name.toLowerCase().includes(q)||x.next?.toLowerCase().includes(q));
      rows.innerHTML=items.map(rowHTML).join('');
      iCount.textContent=db.length;
      // Totals
      const totalAvail = db.reduce((a,b)=>a+(parseFloat(b.available)||0),0);
      const committedTotal = db.reduce((a,b)=>a+((b.status==='Committed')?(parseFloat(b.interest)||0):0),0);
      const weightedTotal = db.reduce((a,b)=>a+(fitFromStatus(b.status)/100)*(parseFloat(b.interest)||0),0);
      // Set KPI values
      iCommittedTotal.textContent = '$'+committedTotal.toLocaleString();
      iAvailable.textContent = '$'+totalAvail.toLocaleString();
      iWeighted.textContent = '$'+weightedTotal.toLocaleString();
      // Progress bars (relative to total available)
      const pct = v => totalAvail>0 ? Math.max(0, Math.min(100, Math.round(100*v/totalAvail))) : 0;
      const pcCommitted = pct(committedTotal);
      const pcWeighted = pct(weightedTotal);
      const fc = document.getElementById('fillCommitted'); if(fc) fc.style.width = pcCommitted+'%';
      const fw = document.getElementById('fillWeighted'); if(fw) fw.style.width = pcWeighted+'%';
    }

    function rowHTML(x){return `<tr><td>${x.name}</td><td>${x.interest||''}</td><td>${x.available||''}</td><td>${x.status}</td><td>${x.next||''}</td><td>${x.due||''}</td><td><button class=\"btn\" onclick='edit(\"${x.id}\")'>Edit</button> <button class=\"btn\" onclick='removeInvestor(\"${x.id}\")'>Delete</button></td></tr>`}

    addBtn.onclick=()=>edit();
    saveBtn.onclick=e=>{e.preventDefault();const id=f_id.value||uid();const o={id,name:f_name.value,status:f_status.value,next:f_next.value,due:f_due.value,interest:f_interest.value,available:f_available.value,fit:fitFromStatus(f_status.value)};const i=db.findIndex(x=>x.id===id);if(i>-1)db[i]=o;else db.push(o);save();modal.close()}
    function edit(id){const x=db.find(r=>r.id===id)||{id:'',name:'',status:'Lead',next:'',due:'',interest:'',available:'',fit:0};f_id.value=x.id;f_name.value=x.name;f_status.value=x.status;f_next.value=x.next;f_due.value=x.due||'';f_interest.value=x.interest||'';f_available.value=x.available||'';modal.showModal()}

    function removeInvestor(id){
      if(confirm('Delete this investor?')){
        db=db.filter(x=>x.id!==id);
        save();
      }
    }

    render();
  </script>
</body>
</html>
