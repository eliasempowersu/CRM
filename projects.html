<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>Projects — MG Capital CRM</title>
  <style>
    :root{--bg:#0a0b10;--card:#121320;--muted:#8b90a5;--text:#eef1ff;--accent:#6e7bff;--accent-2:#45d1c4;--danger:#ff6b6b;--success:#32d49e;--warning:#ffcc66;--ring:0 0 0 2px color-mix(in oklab,var(--accent),transparent 60%);--radius:18px}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Inter,system-ui;background:radial-gradient(1000px 600px at -10% -10%,#2b2e74 0%,transparent 60%),radial-gradient(900px 600px at 110% 10%,#0d5b64 0%,transparent 60%),linear-gradient(180deg,#0a0b10,#0a0b10);color:var(--text)}

    .container{width:100%;max-width:1200px;margin-inline:auto;padding:16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:800;color:#fff;box-shadow:0 8px 30px #0008}
    h1{font-size:clamp(20px,3vw,26px);margin:0}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid #ffffff1a;background:#ffffff10;color:var(--text);cursor:pointer;transition:.2s;backdrop-filter:blur(6px);text-decoration:none;display:inline-block;text-align:center;font-size:14px}
    .btn:hover{transform:translateY(-1px);background:#ffffff1a}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#4b56f7);border-color:#0000;box-shadow:0 6px 24px #6e7bff33}
    .btn.ghost{background:#ffffff08}

    /* KPI cards */
    .metrics{display:grid;gap:12px;grid-template-columns:repeat(4,1fr)}
    .card{background:linear-gradient(180deg,#101123,#0c0d18);border:1px solid #ffffff10;border-radius:18px;padding:12px;box-shadow:0 10px 30px #0006;display:flex;flex-direction:column;justify-content:space-between}
    .metric{display:flex;flex-direction:column;gap:6px;height:100%}
    .metric h3{margin:0;color:#cfd6ff;font-weight:600;font-size:13px}
    .value-row{display:flex;justify-content:space-between;align-items:center}
    .metric .value{font-size:20px;font-weight:800}
    .kpi-icon svg{width:20px;height:20px;opacity:.9}

    /* Table */
    #tableView{overflow-x:auto;-webkit-overflow-scrolling:touch}
    table{width:100%;border-collapse:separate;border-spacing:0 6px;font-size:14px}
    thead th{font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:#b4b8d6;text-align:left;padding:0 10px}
    tbody tr{background:#0e1020;border:1px solid #ffffff14}
    tbody td{padding:10px}
    tbody tr td:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}

    /* Board */
    .board{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .column{min-height:280px;background:#0e1020;border:1px solid #ffffff14;border-radius:18px;padding:12px}
    .col-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;font-size:14px}
    .card-mini{background:#11142a;border:1px solid #ffffff12;border-radius:14px;padding:10px;margin-bottom:10px;font-size:13px}

    footer{opacity:.7;margin-top:16px;font-size:12px}

    /* Modals */
    dialog{border:1px solid #ffffff2a;background:#0e1020;color:var(--text);border-radius:14px;padding:0;width:min(720px,96vw);max-height:90vh;font-size:13px}
    dialog::backdrop{background:#0008}
    .modal-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #ffffff1a;font-size:14px}
    .modal-body{padding:12px 14px;display:grid;gap:8px;overflow:auto}
    .modal-actions{display:flex;justify-content:flex-end;gap:8px;padding:10px 14px;border-top:1px solid #ffffff1a}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:8px}

    .tabs{display:flex;gap:6px;margin-left:auto}
    .tab{padding:6px 10px;border-radius:999px;border:1px solid #ffffff1a;background:#ffffff08;cursor:pointer}
    .tab.active{background:linear-gradient(135deg,var(--accent),#4b56f7);border-color:#0000}

    .hidden{display:none}

    @media (max-width:1024px){.board{grid-template-columns:1fr 1fr}}
    @media (max-width:640px){
      .container{padding:14px}
      .metrics{grid-template-columns:repeat(2,1fr)}
      #tableView>table{min-width:600px}
      .two{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">MG</div>
        <div><h1>Investor & Project Pipeline</h1></div>
      </div>
      <div class="toolbar">
        <a href="projects.html" class="btn primary">Projects</a>
        <a href="investors.html" class="btn ghost">Investors</a>
        <a href="calendar.html" class="btn ghost">Calendar</a>
      </div>
    </header>

    <!-- KPI METRICS -->
    <section class="metrics">
      <div class="card"><div class="metric"><h3>Total Projects</h3><div class="value-row"><div class="value" id="mCount">0</div><div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div></div></div></div>
      <div class="card"><div class="metric"><h3>Active</h3><div class="value-row"><div class="value" id="mActive">0</div><div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg></div></div></div></div>
      <div class="card"><div class="metric"><h3>In Development</h3><div class="value-row"><div class="value" id="mDev">0</div><div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h6l3 7-4 2 2 4-4 2-3-7V3z"/></svg></div></div></div></div>
      <div class="card"><div class="metric"><h3>Proposed</h3><div class="value-row"><div class="value" id="mProp">0</div><div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18h6M10 22h4M12 2a7 7 0 0 0-7 7c0 2.5 1.5 4.5 3.5 5.5h7C17.5 13.5 19 11.5 19 9a7 7 0 0 0-7-7z"/></svg></div></div></div></div>
    </section>

    <section class="card" style="margin-top:12px">
      <div class="toolbar" style="gap:10px;align-items:center">
        <strong>Projects</strong>
        <input id="q" placeholder="Search projects…" style="min-width:220px" />
        <div class="tabs"><button class="tab active" data-view="table">Table</button><button class="tab" data-view="board">Board</button></div>
        <span style="margin-left:auto"></span>
        <button class="btn primary" id="addBtn">+ Add Project</button>
        <button class="btn ghost" id="exportBtn">Export</button>
        <button class="btn ghost" id="importBtn">Import</button>
        <button class="btn" id="backupBtn">Backup</button>
        <button class="btn" id="restoreBtn">Restore</button>
      </div>

      <div id="tableView" style="margin-top:10px">
        <table>
          <thead><tr><th>Name</th><th>Status</th><th>Next Step</th><th>Due</th><th></th></tr></thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

      <div id="boardView" class="board hidden" style="margin-top:10px"></div>
    </section>

    <footer>Data is saved locally in your browser. Export CSV for backups. — MG Capital</footer>
  </div>

  <!-- MODALS -->
  <dialog id="modal"><form method="dialog">
    <div class="modal-head"><strong id="modalTitle">Add Project</strong><button class="btn" value="close">✕</button></div>
    <div class="modal-body">
      <div class="two">
        <label>Name<br/><input id="f_name" required /></label>
        <label>Status<br/><select id="f_status"><option>Active</option><option>In Development</option><option>Proposed</option><option>On Hold</option></select></label>
      </div>
      <div class="two">
        <label>Next Step<br/><input id="f_next" /></label>
        <span></span>
      </div>
      <div class="two">
        <label>Due Date<br/><input id="f_due" type="date" /></label>
        <span></span>
      </div>
      <input id="f_id" type="hidden" />
    </div>
    <div class="modal-actions"><button class="btn" value="close">Cancel</button><button class="btn primary" id="saveBtn">Save</button></div>
  </form></dialog>

  <input type="file" id="filePicker" accept='.csv' style="display:none" />

  <script>
    const STATUSES=["Active","In Development","Proposed","On Hold"];
    function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}

    // Storage
    function load(){try{return JSON.parse(localStorage.getItem('mgcrm_projects')||'[]')}catch{return[]}}
    function save(){localStorage.setItem('mgcrm_projects',JSON.stringify(db));render()}

    let db=load();

    // Render
    function render(){
      const q=(document.getElementById('q').value||'').toLowerCase();
      const items=db.filter(x=>!q||x.name.toLowerCase().includes(q)||x.next?.toLowerCase().includes(q));
      rows.innerHTML=items.map(rowHTML).join('');
      boardView.innerHTML=STATUSES.map(s=>{const list=items.filter(x=>x.status===s);return `<div class="column"><div class="col-head"><strong>${s}</strong><span class="btn ghost" style="padding:3px 8px">${list.length}</span></div>${list.map(cardHTML).join('')}</div>`}).join('');
      // KPIs
      mCount.textContent=db.length;
      mActive.textContent=db.filter(x=>x.status==='Active').length;
      mDev.textContent=db.filter(x=>x.status==='In Development').length;
      mProp.textContent=db.filter(x=>x.status==='Proposed').length;
    }

    function rowHTML(x){return `<tr><td>${x.name}</td><td>${x.status}</td><td>${x.next||''}</td><td>${x.due||''}</td><td><button class="btn" onclick='edit("${x.id}")'>Edit</button></td></tr>`}
    function cardHTML(x){return `<div class="card-mini"><strong>${x.name}</strong><div>${x.status}</div><div>${x.next||''}</div><div class="muted">${x.due?`Due: ${x.due}`:''}</div></div>`}

    // Actions
    addBtn.onclick=()=>edit();
    saveBtn.onclick=e=>{e.preventDefault();const id=f_id.value||uid();const o={id,name:f_name.value,status:f_status.value,next:f_next.value,due:f_due.value};const i=db.findIndex(x=>x.id===id);if(i>-1)db[i]=o;else db.push(o);save();modal.close()}
    function edit(id){const x=db.find(r=>r.id===id)||{id:"",name:"",status:"Active",next:"",due:""};f_id.value=x.id;f_name.value=x.name;f_status.value=x.status;f_next.value=x.next;f_due.value=x.due||"";modal.showModal()}

    // Tabs
    document.querySelectorAll('.tab[data-view]').forEach(btn=>btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab[data-view]').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const view=btn.dataset.view;
      tableView.classList.toggle('hidden',view!=='table');
      boardView.classList.toggle('hidden',view!=='board');
    }));

    // CSV Export/Import/Backup
    exportBtn.onclick=()=>{const headers=['id','name','status','next','due'];const rowsCSV=[headers.join(',')].concat(db.map(o=>headers.map(h=>String(o[h]??'').replace(/"/g,'""')).map(v=>(/[,\n]/.test(v)?`"${v}"`:v)).join(',')));const blob=new Blob([rowsCSV.join('\n')],{type:'text/csv'});const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(blob),download:'projects.csv'});document.body.appendChild(a);a.click();a.remove()}
    importBtn.onclick=()=>filePicker.click();
    filePicker.onchange=async e=>{const f=e.target.files[0];if(!f)return;const tx=await f.text();const lines=tx.split(/\r?\n/).filter(Boolean);const heads=lines.shift().split(',');const idc=k=>heads.indexOf(k);lines.forEach(line=>{const parts=[];let cur='';let inQ=false;for(let i=0;i<line.length;i++){const ch=line[i];if(ch=='"'){if(inQ&&line[i+1]=='"'){cur+='"';i++;}else inQ=!inQ;}else if(ch===','&&!inQ){parts.push(cur);cur='';}else cur+=ch;}parts.push(cur);const o={id:parts[idc('id')]||uid(),name:parts[idc('name')]||'',status:parts[idc('status')]||'Active',next:parts[idc('next')]||'',due:parts[idc('due')]||''};const i=db.findIndex(x=>x.id===o.id);if(i>-1)db[i]=o;else db.push(o);});save();filePicker.value=''}
    backupBtn.onclick=()=>{localStorage.setItem('mgcrm_projects_backup',JSON.stringify(db));alert('Backup saved in this browser.')}
    restoreBtn.onclick=()=>{const snap=localStorage.getItem('mgcrm_projects_backup');if(!snap){alert('No backup found.');return;}try{db=JSON.parse(snap)||[];save();alert('Restored.')}catch{alert('Backup unreadable.')}}

    // Classic seed list (loads when empty)
    const CLASSIC_SEEDS = [
      {name:'MG Capital', status:'Active', next:'Continue Randolph Ave assisted living conversion; finalize Church/Main St redevelopment (under consideration).', due:''},
      {name:'MG Cares Group Homes', status:'In Development', next:'Launch 25 group homes in 3 years; integrate WIOA, YouthBuild, Apprenticeship grants; build Skilled Trades Academy.', due:''},
      {name:'Tiger Sun: Restaurant & Lounge', status:'Proposed', next:'Concept development and launch planning.', due:''},
      {name:'Fuego Tropical', status:'Proposed', next:'Concept planning; prepare hospitality rollout.', due:''},
      {name:'MG Media / Entertainment Ventures', status:'Active Partnerships', next:'Continue DJ bookings, festival & concert production, expand AV partnerships.', due:''},
      {name:'MG Healthcare & Assisted Living', status:'Active', next:'Expand assisted living conversions; pursue HUD alignment and tax credits.', due:''},
      {name:'Altura Global Holdings → Grupo Ultracaribe', status:'Active (Rebranded)', next:'Scale eel exports (DR, Haiti, Colombia → Hong Kong); expand agricultural exports; secure licenses; onboard investors.', due:''},
      {name:'MG Productions & Events', status:'Active', next:'Expand DJ Ed & agency bookings; grow festival/event production; deepen AV/FX partnerships.', due:''},
      {name:'Luxehill Concierge & Stays', status:'Upcoming Launch', next:'Build luxury STR portfolio in Lynchburg & beyond; reach $50K/month revenue; launch VIP concierge services.', due:''},
      {name:'MG Hospitality Ventures', status:'Proposed / Early Stage', next:'Explore boutique hotel and resort partnerships; align with MG Capital.', due:''},
      {name:'MG Real Estate Development', status:'Active & Proposed Mix', next:'Continue acquisitions and redevelopments; structure financing with credits/owner-financing.', due:''}
    ];

    (function hydrate(){
      const stored = load();
      if(!Array.isArray(stored) || stored.length===0){
        db = CLASSIC_SEEDS.map(p=>({id:uid(), ...p}));
        save();
      } else {
        db = stored; render();
      }
    })();
  </script>
</body>
</html>
